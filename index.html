<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ¯æ—¥æ¯›é€‰</title>
    <!-- å¼•å…¥åœ¨çº¿æ¯›ç¬”å­—ä½“ -->
    <link href="https://fonts.googleapis.com/css2?family=ZCOOL+XiaoWei&family=Ma+Shan+Zheng&family=Zhi+Mang+Xing&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: "STXingkai", "STKaiti", "KaiTi", "Ma Shan Zheng", "ZCOOL XiaoWei", "FangSong", serif;
            background: linear-gradient(135deg, #C41E3A 0%, #6B1B4D 100%);
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            padding: 20px;
            overflow-x: hidden;
        }

        .container {
            background: rgba(255, 255, 255, 0.98);
            border-radius: 20px;
            padding: 60px 50px;
            max-width: 900px;
            width: 100%;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
            text-align: center;
            position: relative;
        }

        /* æ‰“å¡å¤©æ•° - å·¦ä¸Šè§’ - å¯ç‚¹å‡» */
        .check-in-days {
            position: absolute;
            top: 20px;
            left: 30px;
            font-size: 18px;
            color: #888;
            font-weight: 600;
            animation: pageFlip 0.6s ease-out;
            cursor: pointer;
            transition: all 0.3s;
            padding: 8px 15px;
            border-radius: 10px;
        }

        .check-in-days:hover {
            background: #f0f0f0;
            color: #C41E3A;
            transform: scale(1.05);
        }

        @keyframes pageFlip {
            0% {
                opacity: 0.3;
                transform: translateY(-10px);
            }
            100% {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* æ—¥å†å¼¹çª— */
        .calendar-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            z-index: 2000;
            justify-content: center;
            align-items: center;
        }

        .calendar-modal.show {
            display: flex;
        }

        .calendar-content {
            background: white;
            border-radius: 20px;
            padding: 40px;
            max-width: 700px;
            width: 90%;
            max-height: 85vh;
            overflow-y: auto;
            position: relative;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
        }

        .calendar-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            border-bottom: 3px solid #DAA520;
            padding-bottom: 15px;
        }

        .calendar-title {
            font-size: 28px;
            color: #8B0000;
            font-weight: 700;
        }

        /* å¾½ç« å±•ç¤ºåŒº */
        .badges-section {
            background: linear-gradient(135deg, #FFF8DC 0%, #FFFAF0 100%);
            border: 2px solid #DAA520;
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 30px;
        }

        .badges-title {
            font-size: 20px;
            color: #8B0000;
            margin-bottom: 15px;
            font-weight: 700;
        }

        .badges-container {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            justify-content: center;
        }

        .badge-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 5px;
        }

        .badge-icon {
            font-size: 50px;
            filter: grayscale(100%) opacity(0.3);
            transition: all 0.3s;
        }

        .badge-icon.earned {
            filter: grayscale(0%) opacity(1);
            animation: badgeEarn 0.6s ease-out;
        }

        @keyframes badgeEarn {
            0% { transform: scale(0) rotate(-180deg); }
            50% { transform: scale(1.2) rotate(10deg); }
            100% { transform: scale(1) rotate(0deg); }
        }

        .badge-label {
            font-size: 12px;
            color: #888;
        }

        .badge-label.earned {
            color: #8B0000;
            font-weight: 700;
        }

        /* æ—¥å†æ ¼å­ */
        .calendar-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 10px;
            margin-bottom: 20px;
        }

        .calendar-weekday {
            font-size: 14px;
            font-weight: 700;
            color: #888;
            text-align: center;
            padding: 10px 0;
        }

        .calendar-day {
            aspect-ratio: 1;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            font-size: 14px;
            background: white;
            position: relative;
        }

        .calendar-day.weekend {
            background: #f8f8f8;
            color: #ccc;
        }

        .calendar-day.checked {
            background: linear-gradient(135deg, #FFD700 0%, #FFA500 100%);
            border-color: #DAA520;
            color: white;
            font-weight: 700;
        }

        .calendar-day.today {
            border-color: #DC143C;
            border-width: 3px;
        }

        .check-mark {
            position: absolute;
            top: 2px;
            right: 2px;
            font-size: 18px;
        }

        /* ç»Ÿè®¡ä¿¡æ¯ */
        .stats-section {
            background: #f8f9fa;
            border-radius: 15px;
            padding: 20px;
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
        }

        .stat-item {
            text-align: center;
        }

        .stat-value {
            font-size: 32px;
            color: #8B0000;
            font-weight: 700;
            margin-bottom: 5px;
        }

        .stat-label {
            font-size: 14px;
            color: #888;
        }

        /* åº•éƒ¨æŒ‰é’®ç»„ */
        .bottom-buttons {
            position: absolute;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            gap: 40px;
            align-items: center;
        }

        .emperor-btn {
            font-size: 16px;
            color: #888;
            cursor: pointer;
            transition: all 0.3s;
            user-select: none;
            padding: 5px 15px;
        }

        .emperor-btn:hover {
            color: #333;
            transform: scale(1.05);
        }

        /* æ”¶è—å’Œèœå• - å³ä¸‹è§’ */
        .bottom-actions {
            position: absolute;
            bottom: 20px;
            right: 30px;
            display: flex;
            gap: 15px;
            align-items: center;
        }

        .favorite-icon {
            font-size: 28px;
            cursor: pointer;
            transition: all 0.3s;
            user-select: none;
        }

        .favorite-icon:hover {
            transform: scale(1.2);
        }

        .favorite-icon.unfavorited {
            color: #ddd;
        }

        .favorite-icon.favorited {
            color: #DC143C;
        }

        .menu-icon {
            font-size: 24px;
            cursor: pointer;
            color: #888;
            transition: all 0.3s;
            line-height: 1;
            font-weight: 700;
        }

        .menu-icon:hover {
            color: #333;
            transform: scale(1.1);
        }

        /* æŠ½å¡åŒºåŸŸ */
        .card-area {
            position: relative;
            min-height: 450px;
            display: flex;
            justify-content: center;
            align-items: center;
            perspective: 1000px;
        }

        /* å¡å † */
        .card-stack {
            position: absolute;
            width: 300px;
            height: 450px;
        }

        .card-back {
            position: absolute;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #8B0000 0%, #DAA520 100%);
            border-radius: 0;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 52px;
            color: #FFD700;
            font-weight: 900;
            border: 3px solid #FFD700;
        }

        /* é£å‡ºçš„å¡ç‰‡ */
        .card-flying {
            position: absolute;
            width: 300px;
            height: 450px;
            background: linear-gradient(135deg, #FFFAF0 0%, #FFF8DC 100%);
            border-radius: 0;
            box-shadow: 0 15px 50px rgba(0, 0, 0, 0.4);
            border: 3px solid #DAA520;
            animation: cardFly 1.5s ease-out forwards;
            opacity: 0;
            z-index: 10;
        }

        @keyframes cardFly {
            0% {
                transform: translateY(0) scale(0.8) rotateY(0deg);
                opacity: 0;
            }
            30% {
                transform: translateY(-100px) scale(1.1) rotateY(180deg);
                opacity: 1;
            }
            60% {
                transform: translateY(-80px) scale(1.05) rotateY(360deg);
            }
            100% {
                transform: translateY(0) scale(1) rotateY(360deg);
                opacity: 1;
            }
        }

        /* å…‰èŠ’æ•ˆæœ */
        .glow-effect {
            position: absolute;
            width: 300px;
            height: 300px;
            background: radial-gradient(circle, rgba(255, 215, 0, 0.8) 0%, transparent 70%);
            border-radius: 50%;
            animation: glowPulse 1.5s ease-out;
            pointer-events: none;
            z-index: 5;
        }

        @keyframes glowPulse {
            0% {
                transform: scale(0);
                opacity: 0;
            }
            50% {
                transform: scale(1.5);
                opacity: 1;
            }
            100% {
                transform: scale(2);
                opacity: 0;
            }
        }

        /* è¯­å½•å†…å®¹ */
        .quote-content {
            display: none;
            animation: fadeIn 1s ease-in;
        }

        .quote-content.show {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .title {
            font-size: 48px;
            color: #C41E3A;
            margin-bottom: 25px;
            font-weight: 900;
            letter-spacing: 8px;
        }

        .date {
            color: #888;
            font-size: 18px;
            margin-bottom: 40px;
            font-weight: 400;
        }

        .quote {
            font-size: 32px;
            line-height: 2.2;
            color: #1a1a1a;
            margin: 40px 0;
            font-weight: 700;
            letter-spacing: 3px;
            text-align: justify;
            text-justify: inter-ideograph;
            text-shadow: 2px 2px 3px rgba(0, 0, 0, 0.15);
        }

        .source {
            color: #888;
            font-size: 20px;
            margin: 30px 0;
            font-weight: 600;
            letter-spacing: 3px;
        }

        .slogan {
            color: #888;
            font-size: 18px;
            margin-top: 20px;
            font-weight: 400;
            letter-spacing: 2px;
        }

        /* ä»Šæ—¥è¿åŠ¿ */
        .fortune-section {
            margin-top: 40px;
            padding: 25px 30px;
            background: linear-gradient(135deg, #FFF8DC 0%, #FFFAF0 100%);
            border-radius: 0;
            border: 2px solid #DAA520;
        }

        .fortune-title {
            font-size: 22px;
            color: #8B0000;
            margin-bottom: 15px;
            font-weight: 700;
        }

        .fortune-text {
            font-size: 18px;
            color: #333;
            line-height: 1.8;
            font-weight: 600;
        }

        /* æ”¶è—åˆ—è¡¨å¼¹çª— */
        .favorites-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }

        .favorites-modal.show {
            display: flex;
        }

        .favorites-content {
            background: white;
            border-radius: 0;
            padding: 40px;
            max-width: 800px;
            max-height: 80vh;
            overflow-y: auto;
            position: relative;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
        }

        .favorites-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            border-bottom: 3px solid #DAA520;
            padding-bottom: 15px;
        }

        .favorites-title {
            font-size: 28px;
            color: #8B0000;
            font-weight: 700;
        }

        .close-modal {
            background: #DC143C;
            color: white;
            border: none;
            padding: 8px 20px;
            border-radius: 0;
            cursor: pointer;
            font-size: 14px;
        }

        .favorite-item {
            background: #FFF8DC;
            border: 2px solid #DAA520;
            border-radius: 0;
            padding: 20px;
            margin-bottom: 15px;
            position: relative;
        }

        .favorite-quote-text {
            font-size: 18px;
            line-height: 1.8;
            color: #1a1a1a;
            margin-bottom: 10px;
        }

        .remove-favorite {
            position: absolute;
            top: 10px;
            right: 10px;
            background: #DC143C;
            color: white;
            border: none;
            padding: 5px 15px;
            border-radius: 0;
            cursor: pointer;
            font-size: 12px;
        }

        .empty-favorites {
            text-align: center;
            color: #888;
            font-size: 18px;
            padding: 40px;
        }

        /* å…³é—­æŒ‰é’® */
        .close-btn {
            position: absolute;
            top: 20px;
            right: 30px;
            background: transparent;
            color: #888;
            border: none;
            font-size: 28px;
            cursor: pointer;
            line-height: 1;
            padding: 0;
            transition: all 0.3s;
        }

        .close-btn:hover {
            color: #333;
            transform: scale(1.1);
        }

    </style>
</head>
<body>
    <div class="container">
        <button class="close-btn" onclick="window.close()" title="å…³é—­">Ã—</button>
        <div class="check-in-days" id="checkInDays" onclick="showCalendar()" title="æŸ¥çœ‹æ‰“å¡æ—¥å†">æ‰“å¡ 1 å¤©</div>

        <!-- åº•éƒ¨æŒ‰é’®ç»„ -->
        <div class="bottom-buttons">
            <span class="emperor-btn" onclick="redrawCard()">æœ•ä¸æ»¡æ„</span>
            <span class="emperor-btn" onclick="closeWindow()">æœ•å·²é˜…</span>
        </div>

        <!-- æŠ½å¡åŒºåŸŸ -->
        <div class="card-area" id="cardArea">
            <div class="card-stack" id="cardStack">
                <div class="card-back">æ¯æ—¥æ¯›é€‰</div>
            </div>
        </div>

        <!-- è¯­å½•å†…å®¹ -->
        <div class="quote-content" id="quoteContent">
            <div class="title">æ¯æ—¥æ¯›é€‰</div>
            <div class="date" id="date"></div>
            <div class="quote" id="quote"></div>
            <div class="source">â€”ã€Šæ¯›æ³½ä¸œé€‰é›†ã€‹â€”</div>
            <div class="slogan">æ¯å¤©ä¸€å¥ï¼Œæ¿€åŠ±å‰è¡Œ</div>

            <!-- ä»Šæ—¥è¿åŠ¿ -->
            <div class="fortune-section">
                <div class="fortune-title">ğŸ“‹ ä»Šæ—¥è¿åŠ¿</div>
                <div class="fortune-text" id="fortuneText"></div>
            </div>
        </div>

        <!-- å³ä¸‹è§’æ“ä½œ -->
        <div class="bottom-actions">
            <span class="favorite-icon unfavorited" id="favoriteIcon" onclick="toggleFavorite()" title="æ”¶è—">â˜†</span>
            <span class="menu-icon" onclick="viewFavorites()" title="æŸ¥çœ‹æ”¶è—">â‰¡</span>
        </div>
    </div>

    <!-- æ—¥å†å¼¹çª— -->
    <div class="calendar-modal" id="calendarModal">
        <div class="calendar-content">
            <div class="calendar-header">
                <div class="calendar-title" id="calendarHeaderTitle">ğŸ“… æ‰“å¡æ—¥å†</div>
                <button class="close-modal" onclick="closeCalendar()">å…³é—­</button>
            </div>

            <!-- å¾½ç« å±•ç¤º -->
            <div class="badges-section">
                <div class="badges-title">ğŸ† æˆ‘çš„å¾½ç« </div>
                <div class="badges-container" id="badgesContainer"></div>
            </div>

            <!-- ç»Ÿè®¡ä¿¡æ¯ -->
            <div class="stats-section">
                <div class="stat-item">
                    <div class="stat-value" id="totalWorkdays">0</div>
                    <div class="stat-label">æ€»å·¥ä½œæ—¥æ‰“å¡</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value" id="currentStreak">0</div>
                    <div class="stat-label">è¿ç»­æ‰“å¡</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value" id="badgeCount">0</div>
                    <div class="stat-label">è·å¾—å¾½ç« </div>
                </div>
            </div>

            <div style="height: 20px;"></div>

            <!-- æ—¥å†æ ¼å­ -->
            <div class="calendar-grid" id="calendarGrid"></div>
        </div>
    </div>

    <!-- æ”¶è—åˆ—è¡¨å¼¹çª— -->
    <div class="favorites-modal" id="favoritesModal">
        <div class="favorites-content">
            <div class="favorites-header">
                <div class="favorites-title">æˆ‘çš„æ”¶è—</div>
                <button class="close-modal" onclick="closeFavorites()">å…³é—­</button>
            </div>
            <div id="favoritesList"></div>
        </div>
    </div>

    <script>
        console.log('è„šæœ¬å¼€å§‹åŠ è½½...');

        // è·å–æˆ–è®¾ç½®ç”¨æˆ·æ ‡è¯†
        function getUserId() {
            let userId = localStorage.getItem('maoismUserId');

            if (!userId) {
                // é¦–æ¬¡è®¿é—®ï¼Œå¼¹çª—è¾“å…¥æ‰‹æœºå·å4ä½
                while (!userId || userId.length !== 4 || isNaN(userId)) {
                    userId = prompt('ğŸ¯ æ¬¢è¿ä½¿ç”¨æ¯æ—¥æ¯›é€‰ï¼\n\nè¯·è¾“å…¥æ‚¨çš„æ‰‹æœºå·å4ä½ï¼ˆç”¨äºè®°å½•æ‚¨çš„æ‰“å¡æ•°æ®ï¼‰ï¼š', '');

                    if (userId === null) {
                        // ç”¨æˆ·å–æ¶ˆï¼Œä½¿ç”¨éšæœºID
                        userId = Math.floor(Math.random() * 10000).toString().padStart(4, '0');
                        break;
                    }

                    userId = userId.trim();

                    if (userId.length !== 4 || isNaN(userId)) {
                        alert('âŒ è¯·è¾“å…¥4ä½æ•°å­—');
                    }
                }

                localStorage.setItem('maoismUserId', userId);
                alert(`âœ… å·²ä¸ºæ‚¨åˆ›å»ºè´¦å·ï¼ˆå°¾å·${userId}ï¼‰ï¼Œæ‚¨çš„æ‰“å¡è®°å½•å°†è¢«ä¿å­˜ï¼`);
            }

            return userId;
        }

        // æ¯›æ³½ä¸œé€‰é›†ç»å…¸è¯­å½•åº“
        const quotes = [
            "æˆ‘ä»¬çš„åŒå¿—åœ¨å›°éš¾çš„æ—¶å€™ï¼Œè¦çœ‹åˆ°æˆç»©ï¼Œè¦çœ‹åˆ°å…‰æ˜ï¼Œè¦æé«˜æˆ‘ä»¬çš„å‹‡æ°”ã€‚",
            "äººæ°‘ï¼Œåªæœ‰äººæ°‘ï¼Œæ‰æ˜¯åˆ›é€ ä¸–ç•Œå†å²çš„åŠ¨åŠ›ã€‚ä¸–ç•Œæ˜¯äººæ°‘çš„ï¼Œåšå·¥çš„äººæœ€æœ‰ç”¨ã€‚",
            "æ˜Ÿæ˜Ÿä¹‹ç«ï¼Œå¯ä»¥ç‡åŸã€‚é©å‘½çš„åŠ›é‡è™½ç„¶å¼€å§‹æ—¶å¾ˆå°ï¼Œä½†æ˜¯å®ƒçš„å‘å±•ä¼šéå¸¸è¿…é€Ÿã€‚",
            "æ²¡æœ‰è°ƒæŸ¥ï¼Œå°±æ²¡æœ‰å‘è¨€æƒã€‚ä¸åšæ­£ç¡®çš„è°ƒæŸ¥ï¼ŒåŒæ ·æ²¡æœ‰å‘è¨€æƒã€‚",
            "è™šå¿ƒä½¿äººè¿›æ­¥ï¼Œéª„å‚²ä½¿äººè½åã€‚æˆ‘ä»¬åº”å½“æ°¸è¿œè®°ä½è¿™ä¸ªçœŸç†ã€‚",
            "ä¸–ç•Œä¸Šæ€•å°±æ€•'è®¤çœŸ'äºŒå­—ï¼Œå…±äº§å…šå°±æœ€è®²è®¤çœŸã€‚",
            "ä¸‹å®šå†³å¿ƒï¼Œä¸æ€•ç‰ºç‰²ï¼Œæ’é™¤ä¸‡éš¾ï¼Œå»äº‰å–èƒœåˆ©ã€‚è¿™æ˜¯æˆ‘ä»¬çš„å£å·ã€‚",
            "å®äº‹æ±‚æ˜¯ï¼Œæ˜¯é©¬å…‹æ€ä¸»ä¹‰çš„æ ¹æœ¬è§‚ç‚¹ï¼Œæ˜¯ä¸­å›½å…±äº§å…šäººè®¤è¯†ä¸–ç•Œã€æ”¹é€ ä¸–ç•Œçš„æ ¹æœ¬è¦æ±‚ã€‚",
            "ä¸€ä¸‡å¹´å¤ªä¹…ï¼Œåªäº‰æœå¤•ã€‚æˆ‘ä»¬è¦æŠ“ç´§æ—¶é—´ï¼ŒåŠªåŠ›å·¥ä½œã€‚",
            "å¥½å¥½å­¦ä¹ ï¼Œå¤©å¤©å‘ä¸Šã€‚æˆ‘ä»¬è¦ä¸æ–­å­¦ä¹ æ–°çŸ¥è¯†ï¼Œæé«˜è‡ªå·±çš„æœ¬é¢†ã€‚"
        ];

        // è¿åŠ¿æ–‡æ¡ˆåº“
        const fortuneTexts = [
            "ä»Šæ—¥é€‚åˆæ·±å…¥è°ƒç ”ã€ç†æ€§åˆ†æã€‚é‡äº‹å¤šè§‚å¯Ÿã€å¤šæ€è€ƒï¼Œå®äº‹æ±‚æ˜¯æ–¹èƒ½æ‰¾åˆ°æ­£ç¡®æ–¹å‘ã€‚",
            "ä»Šæ—¥é€‚åˆæ”»åšå…‹éš¾ã€è¿æ¥æŒ‘æˆ˜ã€‚å›°éš¾åªæ˜¯æš‚æ—¶çš„ï¼ŒåšæŒä¸æ‡ˆå¿…æœ‰æ”¶è·ã€‚",
            "ä»Šæ—¥å®œä½è°ƒè°¦é€Šï¼Œæˆ’éª„æˆ’èºã€‚è™šå¿ƒè¯·æ•™ä»–äººï¼Œä¼šæœ‰æ„å¤–çš„æ”¶è·å’Œå¸®åŠ©ã€‚",
            "ä»Šæ—¥äººé™…è¿ä½³ï¼Œé€‚åˆå›¢é˜Ÿåä½œã€‚å¤šå€¾å¬ä»–äººæ„è§ï¼Œç¾¤ç­–ç¾¤åŠ›äº‹åŠåŠŸå€ã€‚",
            "ä»Šæ—¥å­¦ä¹ è¿æ—ºï¼Œé€‚åˆé’»ç ”æ–°çŸ¥ã€‚ç†è®ºç»“åˆå®è·µï¼Œä¼šæœ‰æ–°çš„çªç ´å’Œé¢†æ‚Ÿã€‚"
        ];

        // å¾½ç« é…ç½®
        const badges = [
            { id: 1, icon: 'ğŸŒŸ', name: 'åˆå¿ƒä¸å¿˜', workdays: 7 },
            { id: 2, icon: 'â­', name: 'åšæŒä¸æ‡ˆ', workdays: 14 },
            { id: 3, icon: 'ğŸ’«', name: 'æŒä¹‹ä»¥æ’', workdays: 21 },
            { id: 4, icon: 'âœ¨', name: 'å‹¤å­¦è‹¦ç»ƒ', workdays: 28 },
            { id: 5, icon: 'ğŸ†', name: 'ç™¾ç‚¼æˆé’¢', workdays: 35 },
            { id: 6, icon: 'ğŸ‘‘', name: 'å­¦ä¹ æ ‡å…µ', workdays: 50 }
        ];

        let currentQuoteIndex = 0;

        // åˆ¤æ–­æ˜¯å¦ä¸ºå·¥ä½œæ—¥ï¼ˆå‘¨ä¸€åˆ°å‘¨äº”ï¼‰
        function isWorkday(date) {
            const day = date.getDay();
            return day >= 1 && day <= 5;
        }

        // è·å–æ—¥æœŸå­—ç¬¦ä¸²
        function getDateStr(date) {
            return `${date.getFullYear()}-${date.getMonth() + 1}-${date.getDate()}`;
        }

        // å…³é—­çª—å£
        function closeWindow() {
            window.close();
        }

        // è·å–ä»Šå¤©çš„æ—¥æœŸå­—ç¬¦ä¸²
        function getTodayStr() {
            const now = new Date();
            return `${now.getFullYear()}-${now.getMonth() + 1}-${now.getDate()}`;
        }

        // æ˜¾ç¤ºæ—¥æœŸ
        function showDate() {
            const now = new Date();
            const dateStr = `${now.getFullYear()}å¹´${now.getMonth() + 1}æœˆ${now.getDate()}æ—¥ æ˜ŸæœŸ${['æ—¥','ä¸€','äºŒ','ä¸‰','å››','äº”','å…­'][now.getDay()]}`;
            document.getElementById('date').textContent = dateStr;
        }

        // æ˜¾ç¤ºæ—¥å†
        function showCalendar() {
            const userId = getUserId();
            document.getElementById('calendarHeaderTitle').textContent = `ğŸ“… æ‰“å¡æ—¥å†ï¼ˆå°¾å·${userId}ï¼‰`;
            renderCalendar();
            document.getElementById('calendarModal').classList.add('show');
        }

        // å…³é—­æ—¥å†
        function closeCalendar() {
            document.getElementById('calendarModal').classList.remove('show');
        }

        // æ¸²æŸ“æ—¥å†
        function renderCalendar() {
            const userId = getUserId();
            const storageKey = `dailyMaoism_${userId}`;
            const data = JSON.parse(localStorage.getItem(storageKey)) || { checkInDates: [], favorites: [] };
            const grid = document.getElementById('calendarGrid');
            const today = new Date();

            // è·å–æœ€è¿‘30å¤©
            const days = [];
            for (let i = 29; i >= 0; i--) {
                const date = new Date(today);
                date.setDate(date.getDate() - i);
                days.push(date);
            }

            // æ‰¾åˆ°ç¬¬ä¸€å¤©æ˜¯å‘¨å‡ 
            const firstDay = days[0].getDay();
            const weekdays = ['æ—¥', 'ä¸€', 'äºŒ', 'ä¸‰', 'å››', 'äº”', 'å…­'];

            // æ¸²æŸ“æ˜ŸæœŸæ ‡é¢˜
            grid.innerHTML = weekdays.map(day =>
                `<div class="calendar-weekday">${day}</div>`
            ).join('');

            // æ·»åŠ ç©ºç™½å ä½
            for (let i = 0; i < firstDay; i++) {
                grid.innerHTML += '<div></div>';
            }

            // æ¸²æŸ“æ—¥æœŸ
            const todayStr = getDateStr(today);
            days.forEach(date => {
                const dateStr = getDateStr(date);
                const isToday = dateStr === todayStr;
                const isWeekend = !isWorkday(date);
                const isChecked = data.checkInDates && data.checkInDates.includes(dateStr);

                const classes = ['calendar-day'];
                if (isWeekend) classes.push('weekend');
                if (isChecked) classes.push('checked');
                if (isToday) classes.push('today');

                grid.innerHTML += `
                    <div class="${classes.join(' ')}">
                        <div>${date.getDate()}</div>
                        ${isChecked ? '<div class="check-mark">âœ“</div>' : ''}
                    </div>
                `;
            });

            // æ¸²æŸ“å¾½ç« 
            renderBadges(data);

            // æ¸²æŸ“ç»Ÿè®¡
            renderStats(data);
        }

        // æ¸²æŸ“å¾½ç« 
        function renderBadges(data) {
            const workdayCount = data.checkInDates ? data.checkInDates.filter(dateStr => {
                const [year, month, day] = dateStr.split('-');
                const date = new Date(year, month - 1, day);
                return isWorkday(date);
            }).length : 0;

            const container = document.getElementById('badgesContainer');
            container.innerHTML = badges.map(badge => {
                const earned = workdayCount >= badge.workdays;
                return `
                    <div class="badge-item">
                        <div class="badge-icon ${earned ? 'earned' : ''}">${badge.icon}</div>
                        <div class="badge-label ${earned ? 'earned' : ''}">${badge.name}</div>
                        <div style="font-size: 11px; color: #aaa;">${badge.workdays}å¤©</div>
                    </div>
                `;
            }).join('');
        }

        // æ¸²æŸ“ç»Ÿè®¡
        function renderStats(data) {
            const workdayCount = data.checkInDates ? data.checkInDates.filter(dateStr => {
                const [year, month, day] = dateStr.split('-');
                const date = new Date(year, month - 1, day);
                return isWorkday(date);
            }).length : 0;

            const earnedBadges = badges.filter(badge => workdayCount >= badge.workdays).length;

            // è®¡ç®—è¿ç»­æ‰“å¡å¤©æ•°
            let streak = 0;
            if (data.checkInDates && data.checkInDates.length > 0) {
                const sortedDates = [...data.checkInDates].sort().reverse();
                const today = new Date();
                let checkDate = new Date(today);

                for (let i = 0; i < 100; i++) {
                    if (!isWorkday(checkDate)) {
                        checkDate.setDate(checkDate.getDate() - 1);
                        continue;
                    }

                    const dateStr = getDateStr(checkDate);
                    if (sortedDates.includes(dateStr)) {
                        streak++;
                        checkDate.setDate(checkDate.getDate() - 1);
                    } else {
                        break;
                    }
                }
            }

            document.getElementById('totalWorkdays').textContent = workdayCount;
            document.getElementById('currentStreak').textContent = streak;
            document.getElementById('badgeCount').textContent = earnedBadges;
        }

        // åˆå§‹åŒ–
        function init() {
            console.log('åˆå§‹åŒ–å¼€å§‹...');

            // è·å–ç”¨æˆ·ID
            const userId = getUserId();
            console.log('å½“å‰ç”¨æˆ·ID:', userId);

            showDate();

            // è¯»å–ç”¨æˆ·ä¸“å±æ•°æ®
            const storageKey = `dailyMaoism_${userId}`;
            let data = localStorage.getItem(storageKey);
            console.log('localStorageæ•°æ®:', data);

            if (!data) {
                data = {
                    userId: userId,
                    lastDate: '',
                    checkInDates: [],
                    favorites: []
                };
            } else {
                data = JSON.parse(data);
                // å…¼å®¹æ—§ç‰ˆæœ¬æ•°æ®
                if (!data.checkInDates) {
                    data.checkInDates = [];
                }
            }

            const today = getTodayStr();
            console.log('ä»Šå¤©æ—¥æœŸ:', today);

            // æ–°çš„ä¸€å¤©
            const todayDate = new Date();
            if (data.lastDate !== today) {
                console.log('æ–°çš„ä¸€å¤©');
                data.lastDate = today;

                if (isWorkday(todayDate)) {
                    // åªç»Ÿè®¡å·¥ä½œæ—¥
                    if (!data.checkInDates.includes(today)) {
                        data.checkInDates.push(today);
                    }
                }

                localStorage.setItem(storageKey, JSON.stringify(data));
            } else {
                // åŒä¸€å¤©ï¼Œä½†æ£€æŸ¥æ˜¯å¦éœ€è¦è¡¥å……ä»Šå¤©çš„æ‰“å¡è®°å½•ï¼ˆå…¼å®¹æ—§ç‰ˆæœ¬æ•°æ®ï¼‰
                if (isWorkday(todayDate) && !data.checkInDates.includes(today)) {
                    console.log('è¡¥å……ä»Šå¤©çš„æ‰“å¡è®°å½•');
                    data.checkInDates.push(today);
                    localStorage.setItem(storageKey, JSON.stringify(data));
                }
            }

            // è®¡ç®—å·¥ä½œæ—¥æ‰“å¡å¤©æ•°
            const workdayCount = data.checkInDates.filter(dateStr => {
                const [year, month, day] = dateStr.split('-');
                const date = new Date(year, month - 1, day);
                return isWorkday(date);
            }).length;

            // æ›´æ–°æ‰“å¡å¤©æ•°æ˜¾ç¤ºï¼ˆæ˜¾ç¤ºå°¾å·ï¼‰
            document.getElementById('checkInDays').textContent = `æ‰“å¡ ${workdayCount} å¤©ï¼ˆå°¾å·${userId}ï¼‰`;

            console.log('åˆå§‹åŒ–å®Œæˆï¼Œå‡†å¤‡æŠ½å¡');

            // è‡ªåŠ¨æŠ½ç¬¬ä¸€å¼ å¡
            setTimeout(() => {
                console.log('æ‰§è¡Œè‡ªåŠ¨æŠ½å¡');
                playCardAnimation();
            }, 500);
        }

        // æŠ½å¡
        function drawQuote() {
            currentQuoteIndex = Math.floor(Math.random() * quotes.length);
            console.log('æŠ½åˆ°è¯­å½•ç´¢å¼•:', currentQuoteIndex);
            return true;
        }

        // å†æŠ½ä¸€æ¬¡
        function redrawCard() {
            console.log('ç‚¹å‡»å†æŠ½ä¸€æ¬¡');

            drawQuote();

            document.getElementById('quoteContent').classList.remove('show');
            document.getElementById('cardArea').style.display = 'flex';

            setTimeout(() => {
                playCardAnimation();
            }, 300);
        }

        // æ’­æ”¾æŠ½å¡åŠ¨ç”»
        function playCardAnimation() {
            console.log('æ’­æ”¾æŠ½å¡åŠ¨ç”»');

            drawQuote();

            const cardArea = document.getElementById('cardArea');

            const glow = document.createElement('div');
            glow.className = 'glow-effect';
            cardArea.appendChild(glow);

            const flyingCard = document.createElement('div');
            flyingCard.className = 'card-flying';
            cardArea.appendChild(flyingCard);

            setTimeout(() => {
                cardArea.style.display = 'none';
                showQuoteContent();
            }, 1500);
        }

        // æ˜¾ç¤ºè¯­å½•å†…å®¹
        function showQuoteContent() {
            console.log('æ˜¾ç¤ºè¯­å½•å†…å®¹');

            const quote = quotes[currentQuoteIndex];
            document.getElementById('quote').textContent = quote;

            const fortune = fortuneTexts[currentQuoteIndex % fortuneTexts.length];
            document.getElementById('fortuneText').textContent = fortune;

            updateFavoriteIcon();

            document.getElementById('quoteContent').classList.add('show');
        }

        // åˆ‡æ¢æ”¶è—
        function toggleFavorite() {
            const userId = getUserId();
            const storageKey = `dailyMaoism_${userId}`;
            let data = JSON.parse(localStorage.getItem(storageKey));
            const index = data.favorites.indexOf(currentQuoteIndex);

            if (index > -1) {
                data.favorites.splice(index, 1);
            } else {
                data.favorites.push(currentQuoteIndex);
            }

            localStorage.setItem(storageKey, JSON.stringify(data));
            updateFavoriteIcon();
        }

        // æ›´æ–°æ”¶è—å›¾æ ‡
        function updateFavoriteIcon() {
            const userId = getUserId();
            const storageKey = `dailyMaoism_${userId}`;
            const icon = document.getElementById('favoriteIcon');
            const data = JSON.parse(localStorage.getItem(storageKey));
            const isFavorited = data.favorites.includes(currentQuoteIndex);

            if (isFavorited) {
                icon.textContent = 'â˜…';
                icon.className = 'favorite-icon favorited';
            } else {
                icon.textContent = 'â˜†';
                icon.className = 'favorite-icon unfavorited';
            }
        }

        // æŸ¥çœ‹æ”¶è—
        function viewFavorites() {
            const userId = getUserId();
            const storageKey = `dailyMaoism_${userId}`;
            const modal = document.getElementById('favoritesModal');
            const listEl = document.getElementById('favoritesList');
            const data = JSON.parse(localStorage.getItem(storageKey));
            const favorites = data.favorites;

            if (favorites.length === 0) {
                listEl.innerHTML = '<div class="empty-favorites">æš‚æ— æ”¶è—ï¼Œå¿«å»æ”¶è—å–œæ¬¢çš„è¯­å½•å§ï¼</div>';
            } else {
                listEl.innerHTML = favorites.map(index => `
                    <div class="favorite-item">
                        <div class="favorite-quote-text">${quotes[index]}</div>
                        <button class="remove-favorite" onclick="removeFavorite(${index})">å–æ¶ˆæ”¶è—</button>
                    </div>
                `).join('');
            }

            modal.classList.add('show');
        }

        // å…³é—­æ”¶è—åˆ—è¡¨
        function closeFavorites() {
            document.getElementById('favoritesModal').classList.remove('show');
        }

        // ç§»é™¤æ”¶è—
        function removeFavorite(index) {
            const userId = getUserId();
            const storageKey = `dailyMaoism_${userId}`;
            let data = JSON.parse(localStorage.getItem(storageKey));
            const favIndex = data.favorites.indexOf(index);
            if (favIndex > -1) {
                data.favorites.splice(favIndex, 1);
            }
            localStorage.setItem(storageKey, JSON.stringify(data));

            viewFavorites();

            if (index === currentQuoteIndex) {
                updateFavoriteIcon();
            }
        }

        console.log('å‡†å¤‡æ‰§è¡Œwindow.onload');
        window.onload = function() {
            console.log('window.onloadæ‰§è¡Œ');
            init();
        };

        console.log('è„šæœ¬åŠ è½½å®Œæˆ');
    </script>
</body>
</html>
